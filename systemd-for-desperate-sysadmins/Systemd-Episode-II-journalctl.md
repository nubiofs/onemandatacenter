# Help! Systemd ate my Linux!

## Episode II: Them logs

On Episode I, you learned that systemd ate most of your basic service managing tools. Even though it didn't eat *ps* or *ls* (yet), you'll learn that it's a lot worse than it seems, although it's the better kind of worse. 

### Preamble: Logging on prehistorical Linux (you can skip this) 

Loggin on Linux usually relies on the /dev/log socket. Programs write preformatted messages on it, and a daemon (usually rsyslogd) collects it. On 99% of the distros, you're stuck with syslog facility and priorities and a very limitting form factor.

Systemd crushes your soul and eats the logging subsystem, storing basically all messages generated by its units on this thing called journal. And to make life of all those greppers' around there (grep this, grep that), it's not a real text file, but a binary one.

Your only gateway to all these messages is the **journalctl** command.

### Show me logs!

Ok then! 

* Read everything!

```
# journalctl 
-- Logs begin at Qua 2017-06-07 23:11:27 BRT, end at Qui 2017-06-08 01:34:47 BRT. --
Jun 07 23:11:27 heaven systemd-journald[234]: Runtime journal (/run/log/journal/) is 8.0M, max 78.6M, 70.6M free.
Jun 07 23:11:28 heaven kernel: microcode: CPU0 microcode updated early to revision 0x1d, date = 2015-08-13
Jun 07 23:11:28 heaven kernel: Initializing cgroup subsys cpuset

```

* But it started from the oldest! Get me the new stuff!

```
# journalctl -e
```

* Okay, too much. Show me just messages since boot:

```
# journalctl -b
```
(Note: this is freacking awesome, it'll show you real boot logs. syslog wouldn't be able to do this since it wouldnt be started until late at init process.)

* I liked the kernel message, get me *more*, and only that:

```
# journalctl -k
```

* Tail-f me the logs!

```
# journalctl -f 
```

You can get really fancy with this stuff, doing like this to list all the boots:
```
#  journalctl --list-boots
-1 6948f719272d435eaf05058923e6ddbc Qua 2017-06-07 23:11:27 BRT—Qui 2017-06-08 0
 0 6948f719272d435eaf05058923e6ddbc Qui 2017-06-08 01:37:45 BRT—Qui 2017-06-08 0
``` 

And then going after the boot before this one, if your stuff is decently configured (mine is not):
```
# journalctl -b -1
Specifying boot ID has no effect, no persistent journal was found
```

Whatever.

A couple more things is worth mentioning on this section:

* Logs since specific time:
```
journalctl --since '2017-06-08 00:00' --until '2017-06-08 01:00'
```

It was always kind of painful to trim logs to get just the part you needed. Not anymore!

Even funkier is the possibility to specify like a time in the future and '-f' it, so when a certain cron job tests, you can get the long from that time discarding all the trash in between.

```
journalctl --since '2017-06-08 00:00' -f
```
 
### That's nice, but there's too much stuff mixed up

True dat.

That's why, obviously, you can see the logs of your units, like your services!

```
# # You can filter by your service units:
# journalctl -u sshd

# # or
# journalctl -b -u httpd

# # or 
# journalctl --since '2017-06-08 00:00' -fu nginx

# # You can also filter by PID:
# journalctl _PID=6969

# # Or by user
# journalctl _UID=696969696 

# # Wanna see stuff that generated logs and used bash on your system?
# journalctl /bin/bash

# # And, of course, if you miss syslog, you can filter by priority:
# journalctl -p err 

# # Now if you wanna be a show-off, make it output a json
# journalctl _UID=696969696 -o json

# # or a prettier json
# journalctl _PID=6969 -o json-pretty
```

 
